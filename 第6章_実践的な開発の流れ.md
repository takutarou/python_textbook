# 第6章：実践的な開発の流れ

## この章で学ぶこと
- プロジェクト開始から完成までの標準的な手順
- デバッグ（エラー修正）の基本的な方法
- 読みやすいコードを書くためのポイント

これまで学んだ知識を統合して、実際の開発の流れを身につけましょう。

---

## 6.1 スクリプト作成の標準手順（チェックリスト形式）

新しいプロジェクトを始める時の手順を、チェックリスト形式でまとめます。

### 完全版チェックリスト

```
□ 1. プロジェクトフォルダを作成
□ 2. VS Codeでフォルダを開く
□ 3. conda環境を作成
□ 4. conda環境をアクティベート
□ 5. VS Codeでカーネル（インタープリタ）を選択
□ 6. 必要なライブラリをconda install（-c conda-forge）
□ 7. .ipynbファイルを作成
□ 8. import文を記述
□ 9. コードを記述
□ 10. セルを実行・テスト
□ 11. エラーがあれば修正
□ 12. 動作確認完了
```

### 詳細な手順解説

#### ステップ1：プロジェクトフォルダを作成

**目的：** プロジェクト専用の作業場所を作る

**Anaconda Promptで実行：**
```bash
cd %USERPROFILE%\Documents\python_projects
mkdir sales_analysis
cd sales_analysis
```

**フォルダ名のルール再確認：**
- 英数字とアンダースコア、ハイフンのみ
- 日本語・スペース禁止
- プロジェクトの内容がわかる名前

#### ステップ2：VS Codeでフォルダを開く

**目的：** 開発環境を準備する

1. VS Codeを起動
2. 「ファイル」→「フォルダーを開く」
3. `sales_analysis` フォルダを選択
4. 左側のエクスプローラーにフォルダが表示されることを確認

#### ステップ3：conda環境を作成

**目的：** プロジェクト専用の独立した環境を作る

**ターミナルで実行：**
```bash
conda create -n sales_analysis python=3.11
```

**確認メッセージで `y` を入力**

**ポイント：**
- 環境名は、プロジェクト名と揃えると管理しやすい
- Pythonバージョンは3.10以上を推奨

#### ステップ4：conda環境をアクティベート

**目的：** 作成した環境を有効にする

```bash
conda activate sales_analysis
```

**確認：**
プロンプトが `(sales_analysis)` に変わることを確認

```bash
# 変更前
(base) C:\Users\username>

# 変更後
(sales_analysis) C:\Users\username>
```

#### ステップ5：VS Codeでカーネル（インタープリタ）を選択

**目的：** VS Codeに使用する環境を教える

1. `Ctrl + Shift + P`
2. `Python: Select Interpreter` と入力
3. `Python 3.11.5 ('sales_analysis': conda)` を選択
4. VS Code右下のステータスバーで確認

**または：**
- 右下のPythonバージョン表示を直接クリック

**Jupyterノートブックの場合：**
- ノートブックを開いた時に、右上の「カーネルを選択」から選択

#### ステップ6：必要なライブラリをconda install

**目的：** プロジェクトで使うライブラリを準備する

**例：データ分析プロジェクトの場合**
```bash
conda install -c conda-forge pandas numpy matplotlib openpyxl
```

> **重要：** ライセンス問題を避けるため、必ず `-c conda-forge` を付けてください。

**よく使うライブラリセット：**

```bash
# データ分析系
conda install -c conda-forge pandas numpy matplotlib seaborn

# Excel操作系
conda install -c conda-forge pandas openpyxl xlrd

# Web関連
conda install -c conda-forge requests beautifulsoup4

# 機械学習系
conda install -c conda-forge pandas numpy scikit-learn
```

**ポイント：**
- 複数のライブラリを一度にインストールできる
- 後から追加もできるので、最初は必要最小限でOK
- 必ず `-c conda-forge` を付ける

**インストールの確認：**
```bash
conda list
```

#### ステップ7：.ipynbファイルを作成

**目的：** コードを書くノートブックファイルを用意する

**VS Codeで：**
1. エクスプローラーの「新しいファイル」アイコンをクリック
2. ファイル名を入力：`main.ipynb`（またはわかりやすい名前）
3. Enterで確定
4. カーネルを選択（`sales_analysis` 環境）

**ファイル名のポイント：**
- メインの分析：`main.ipynb` または `analysis.ipynb`
- データ処理：`process_data.ipynb`
- グラフ作成：`create_graph.ipynb`
- 内容がわかる名前にする

#### ステップ8：import文を記述

**目的：** 使用するライブラリを宣言する

**最初のセルに書く：**
```python
# ライブラリのインポート
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
```

**順番の慣習：**
1. 標準ライブラリ
2. 外部ライブラリ
3. 自作モジュール

**例（セル1）：**
```python
# 標準ライブラリ
import os
import sys
from datetime import datetime

# 外部ライブラリ
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 自作モジュール（後で学びます）
# import my_functions
```

**Jupyterノートブックの利点：**
- セルを実行すれば、import文が適用される
- 以降のセルで、インポートしたライブラリを使える

#### ステップ9：コードを記述

**目的：** 実際の処理を書く

**基本構造（複数セルに分けて記述）：**

**セル1：ライブラリのインポート**
```python
import pandas as pd
import matplotlib.pyplot as plt
```

**セル2：データ読み込み**
```python
# 定数の定義
INPUT_FILE = "data.csv"

# データ読み込み
data = pd.read_csv(INPUT_FILE)

# データの確認
print(data.head())
```

**セル3：データ処理**
```python
# データ処理
result = data["amount"].sum()

# 結果表示
print(f"合計: {result}")
```

**セル4：グラフ作成（オプション）**
```python
# グラフ作成
data.plot(x="date", y="amount", kind="bar")
plt.title("Sales Analysis")
plt.show()
```

**Jupyterノートブックの構造のメリット：**
- セルごとに実行できるので、途中経過を確認しやすい
- データを読み込んだ後、何度もセル3を修正して実行できる
- エラーが出ても、該当セルだけ修正すればOK

#### ステップ10：セルを実行・テスト

**目的：** コードが正しく動くか確認する

**実行方法：**
- 各セルを `Shift + Enter` で順番に実行
- または、上部の「▶ すべて実行」ボタン

**確認すること：**
- 各セルでエラーが出ないか
- 期待した結果が出力されるか
- グラフが正しく表示されるか

#### ステップ11：エラーがあれば修正

**目的：** 問題を見つけて直す

**基本的なデバッグ方法（次の節で詳しく解説）：**
1. エラーメッセージを読む
2. エラーの行番号を確認
3. print文で値を確認
4. 修正して再実行

#### ステップ12：動作確認完了

**目的：** プロジェクトを完成させる

**最終チェック：**
- [ ] すべての機能が動作する
- [ ] エラーが出ない
- [ ] 結果が正しい
- [ ] コメントを書いた
- [ ] ファイル名がわかりやすい

---

## 6.2 デバッグの基本

**デバッグ**とは、プログラムのバグ（虫＝エラー）を取り除くこと。

### エラーメッセージの読み方

Pythonのエラーメッセージは、問題解決のヒントが詰まっています。

#### エラーメッセージの構造

```python
Traceback (most recent call last):
  File "main.py", line 10, in <module>
    result = data["amount"].sum()
NameError: name 'data' is not defined
```

**読み方：**

1. **`Traceback (most recent call last):`**
   - エラーが発生した経緯を示す

2. **`File "main.py", line 10, in <module>`**
   - ファイル名：`main.py`
   - 行番号：10行目
   - どこでエラーが起きたか

3. **`result = data["amount"].sum()`**
   - 問題のあるコード行

4. **`NameError: name 'data' is not defined`**
   - エラーの種類：`NameError`
   - 詳細：`data` という名前が定義されていない

#### 主なエラーの種類と意味

| エラー名 | 意味 | よくある原因 |
|---------|------|-------------|
| **SyntaxError** | 文法エラー | 括弧の閉じ忘れ、コロンの忘れ |
| **NameError** | 名前エラー | 変数やライブラリの名前が間違っている |
| **TypeError** | 型エラー | 数値と文字列を混ぜて計算しようとした |
| **ValueError** | 値エラー | 関数に不適切な値を渡した |
| **IndexError** | インデックスエラー | リストの範囲外を参照 |
| **KeyError** | キーエラー | 辞書に存在しないキーを参照 |
| **FileNotFoundError** | ファイルが見つからない | ファイルパスが間違っている |
| **ModuleNotFoundError** | モジュールが見つからない | ライブラリがインストールされていない |
| **AttributeError** | 属性エラー | 存在しないメソッドを呼び出そうとした |
| **IndentationError** | インデントエラー | 字下げが間違っている |

### print文でのデバッグ

最も基本的で効果的なデバッグ方法。

#### 基本的な使い方

```python
import pandas as pd

# データ読み込み
data = pd.read_csv("sales.csv")
print("データ読み込み完了")  # ← ここまで来たか確認
print(f"データの行数: {len(data)}")  # ← データ量を確認

# 集計処理
total = data["amount"].sum()
print(f"合計: {total}")  # ← 計算結果を確認

print("処理完了")
```

#### 変数の中身を確認

```python
# 変数の値を確認
price = 1000
quantity = 3
print(f"price: {price}")
print(f"quantity: {quantity}")

# 計算前の確認
total = price * quantity
print(f"total: {total}")
```

#### データフレームの確認（pandas）

```python
import pandas as pd

data = pd.read_csv("sales.csv")

# 先頭5行を表示
print(data.head())

# データの形状（行数、列数）
print(f"Shape: {data.shape}")

# 列名を表示
print(f"Columns: {data.columns.tolist()}")

# データ型を確認
print(data.dtypes)

# 基本統計量
print(data.describe())
```

#### リストや辞書の確認

```python
# リスト
numbers = [1, 2, 3, 4, 5]
print(f"リスト: {numbers}")
print(f"長さ: {len(numbers)}")

# 辞書
user = {"name": "太郎", "age": 25}
print(f"辞書: {user}")
print(f"名前: {user['name']}")
```

#### デバッグ用のprint文の書き方

```python
# わかりやすいラベルをつける
print("=== データ読み込み開始 ===")
data = pd.read_csv("sales.csv")
print("=== データ読み込み完了 ===")

# 区切り線を使う
print("-" * 50)
print("処理結果")
print("-" * 50)

# 変数名と値を一緒に表示
value = 100
print(f"value = {value}")
```

### VS Codeのデバッグ機能（簡単な紹介）

VS Codeには高度なデバッグ機能がありますが、ここでは基本だけ紹介します。

#### ブレークポイントの設定

1. コードの行番号の左側をクリック
2. 赤い丸（●）が表示される
3. その行で実行が一時停止する

#### デバッグの実行

1. `F5` キーを押す
2. 「Python Debugger」を選択
3. ブレークポイントで停止
4. 変数の値を確認できる

**詳細は後で学ぶので、今は print文デバッグで十分です！**

### デバッグの手順

エラーが出た時の標準的な対処手順：

#### ステップ1：エラーメッセージを読む

```
NameError: name 'data' is not defined
```

「`data` という名前が定義されていない」

#### ステップ2：該当行を確認

```python
File "main.py", line 10
```

10行目を見る

#### ステップ3：原因を推測

- `data` を定義し忘れた？
- 変数名のタイプミス？
- インデントが間違っている？

#### ステップ4：print文で確認

```python
# 8行目の後に追加
print("ここまで実行された")
data = pd.read_csv("sales.csv")
print(f"data: {type(data)}")  # dataが読み込まれたか確認
```

#### ステップ5：修正して再実行

問題を修正して、もう一度実行。

#### ステップ6：まだエラーが出る場合

- Google検索：エラーメッセージをそのまま検索
- 公式ドキュメントを確認
- 社内で質問

---

## 6.3 コードの管理

読みやすく、メンテナンスしやすいコードを書くためのポイント。

### コメントの書き方

#### ファイル先頭のコメント

```python
"""
売上データ分析スクリプト

機能：
- 売上CSVファイルを読み込む
- 商品別・月別の集計を行う
- グラフを作成して保存する

作成日：2024-01-15
作成者：山田太郎
"""

import pandas as pd
```

#### 処理の説明コメント

```python
# データの読み込み
data = pd.read_csv("sales.csv")

# 欠損値を削除
data = data.dropna()

# 日付型に変換
data["date"] = pd.to_datetime(data["date"])

# 月別集計
monthly_sales = data.groupby(data["date"].dt.month)["amount"].sum()
```

#### 複雑な処理の説明

```python
# 商品コードから商品カテゴリを抽出
# 例：P001 → カテゴリP、001 → 商品番号
data["category"] = data["product_code"].str[0]
data["product_number"] = data["product_code"].str[1:]
```

#### コメントを書く場所

**✅ 良い例：**
```python
# 消費税を計算（税率10%）
tax = price * 0.1

# 異常値を除外（金額が0円以下のデータ）
data = data[data["amount"] > 0]
```

**❌ 悪い例：**
```python
# 変数に代入
x = 10  # 意味のないコメント

# プリント
print(x)  # 見ればわかることを書いている
```

**コメントの原則：**
- 「何をしているか」は書かない（コードを読めばわかる）
- 「なぜそうしているか」を書く

### 関数に分ける考え方

同じ処理を何度も書くのは避けましょう。

#### 関数を使わない例（悪い例）

```python
import pandas as pd

# データ1の処理
data1 = pd.read_csv("sales_2023.csv")
data1 = data1.dropna()
data1["tax"] = data1["amount"] * 0.1
total1 = data1["amount"].sum()
print(f"2023年合計: {total1}")

# データ2の処理（同じことを繰り返している）
data2 = pd.read_csv("sales_2024.csv")
data2 = data2.dropna()
data2["tax"] = data2["amount"] * 0.1
total2 = data2["amount"].sum()
print(f"2024年合計: {total2}")
```

#### 関数を使う例（良い例）

```python
import pandas as pd

def process_sales_data(filename):
    """売上データを処理して合計を返す"""
    # データ読み込み
    data = pd.read_csv(filename)

    # 欠損値削除
    data = data.dropna()

    # 消費税計算
    data["tax"] = data["amount"] * 0.1

    # 合計計算
    total = data["amount"].sum()

    return total

# 関数を使って処理
total_2023 = process_sales_data("sales_2023.csv")
print(f"2023年合計: {total_2023}")

total_2024 = process_sales_data("sales_2024.csv")
print(f"2024年合計: {total_2024}")
```

**メリット：**
- コードの重複がない
- 修正が一箇所で済む
- テストしやすい
- 読みやすい

#### 関数の基本構造

```python
def 関数名(引数1, 引数2):
    """関数の説明（ドキュメント文字列）"""
    # 処理
    結果 = 引数1 + 引数2
    return 結果

# 関数の呼び出し
答え = 関数名(10, 20)
print(答え)  # 30
```

#### 実用的な関数の例

```python
def calculate_tax(price, tax_rate=0.1):
    """
    税込価格を計算する

    引数:
        price: 税抜価格
        tax_rate: 税率（デフォルト0.1 = 10%）

    戻り値:
        税込価格
    """
    tax = price * tax_rate
    total = price + tax
    return total

# 使用例
price1 = calculate_tax(1000)  # 1100.0
price2 = calculate_tax(2000, 0.08)  # 2160.0（税率8%）
```

### コードの可読性を高める工夫

#### 1. 変数名を分かりやすく

**❌ 悪い例：**
```python
a = 1000
b = 0.1
c = a * b
d = a + c
```

**✅ 良い例：**
```python
price = 1000
tax_rate = 0.1
tax = price * tax_rate
total = price + tax
```

#### 2. マジックナンバーを避ける

**❌ 悪い例：**
```python
tax = price * 0.1
shipping = 500
```

**✅ 良い例：**
```python
TAX_RATE = 0.1  # 定数は大文字で
SHIPPING_FEE = 500

tax = price * TAX_RATE
shipping = SHIPPING_FEE
```

#### 3. 適切に改行・空行を入れる

**❌ 悪い例：**
```python
import pandas as pd
data = pd.read_csv("sales.csv")
data = data.dropna()
total = data["amount"].sum()
print(total)
```

**✅ 良い例：**
```python
import pandas as pd

# データ読み込み
data = pd.read_csv("sales.csv")
data = data.dropna()

# 集計
total = data["amount"].sum()

# 結果表示
print(f"合計: {total}")
```

#### 4. 一行を短く保つ

**❌ 悪い例：**
```python
result = data[(data["category"] == "A") & (data["amount"] > 1000) & (data["date"] >= "2024-01-01")]["amount"].sum()
```

**✅ 良い例：**
```python
# 条件で絞り込み
filtered = data[
    (data["category"] == "A") &
    (data["amount"] > 1000) &
    (data["date"] >= "2024-01-01")
]

# 合計を計算
result = filtered["amount"].sum()
```

---

## 実践例：完全な開発フロー

実際のプロジェクトを通して、学んだことを実践しましょう。

### プロジェクト：売上データ分析ツール

**目的：**
- 売上CSVを読み込む
- 月別売上を集計
- グラフを作成
- 結果をファイルに保存

### 完全な手順

#### 1. プロジェクト準備

```bash
# フォルダ作成
cd ~/Documents/python_projects
mkdir sales_analyzer
cd sales_analyzer

# 環境作成
conda create -n sales_analyzer python=3.11
conda activate sales_analyzer

# ライブラリインストール
conda install pandas matplotlib openpyxl
```

#### 2. VS Codeで開く

1. VS Codeを起動
2. フォルダを開く：`sales_analyzer`
3. インタープリタ選択：`sales_analyzer`
4. ターミナルを開く（自動でアクティベートされる）

#### 3. サンプルデータ作成

`sales.csv` を作成：

```csv
date,product,category,amount
2024-01-15,Product_A,Electronics,15000
2024-01-20,Product_B,Books,3000
2024-02-05,Product_C,Electronics,25000
2024-02-10,Product_A,Electronics,18000
2024-03-01,Product_B,Books,4000
2024-03-15,Product_C,Electronics,30000
```

#### 4. Jupyterノートブック作成

`main.ipynb` を作成し、以下のセルを順番に作成：

**セル1（Markdownセル）：**
```markdown
# 売上データ分析ツール

**機能：**
- 売上CSVの読み込み
- 月別売上集計
- カテゴリ別売上集計
- グラフ作成

**作成日：** 2024-01-15
```

**セル2（コードセル）：ライブラリのインポート**
```python
import pandas as pd
import matplotlib.pyplot as plt
from datetime import datetime

# 定数定義
INPUT_FILE = "sales.csv"
TAX_RATE = 0.1
```

**セル3（Markdownセル）：**
```markdown
## データ読み込み
```

**セル4（コードセル）：データ読み込みと確認**
```python
# データ読み込み
print(f"データを読み込んでいます: {INPUT_FILE}")
data = pd.read_csv(INPUT_FILE)

# 日付型に変換
data["date"] = pd.to_datetime(data["date"])

print(f"読み込み完了: {len(data)}件")

# データの確認
print("\nデータの先頭5行:")
print(data.head())

print("\nデータの概要:")
print(data.info())
```

**セル5（Markdownセル）：**
```markdown
## 月別売上集計
```

**セル6（コードセル）：月別集計**
```python
# 月別集計
print("月別集計を実行中...")
monthly_sales = data.groupby(data["date"].dt.month)["amount"].sum()

print("\n【月別売上】")
for month, amount in monthly_sales.items():
    print(f"{month}月: ¥{amount:,}")
```

**セル7（Markdownセル）：**
```markdown
## カテゴリ別売上集計
```

**セル8（コードセル）：カテゴリ別集計**
```python
# カテゴリ別集計
print("カテゴリ別集計を実行中...")
category_sales = data.groupby("category")["amount"].sum()

print("\n【カテゴリ別売上】")
for category, amount in category_sales.items():
    print(f"{category}: ¥{amount:,}")
```

**セル9（Markdownセル）：**
```markdown
## 全体統計
```

**セル10（コードセル）：全体統計**
```python
# 全体統計
total_sales = data["amount"].sum()
avg_sales = data["amount"].mean()

print("=" * 50)
print("集計結果サマリー")
print("=" * 50)
print(f"\n【全体統計】")
print(f"総売上: ¥{total_sales:,}")
print(f"平均売上: ¥{avg_sales:,.0f}")
print(f"取引件数: {len(data)}件")
print("=" * 50)
```

**セル11（Markdownセル）：**
```markdown
## グラフ作成
```

**セル12（コードセル）：グラフ表示**
```python
# 2つのグラフを並べて表示
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))

# 月別売上グラフ
monthly_sales.plot(kind="bar", ax=ax1, color="skyblue")
ax1.set_title("Monthly Sales")
ax1.set_xlabel("Month")
ax1.set_ylabel("Amount (Yen)")

# カテゴリ別売上グラフ
category_sales.plot(kind="bar", ax=ax2, color="lightcoral")
ax2.set_title("Sales by Category")
ax2.set_xlabel("Category")
ax2.set_ylabel("Amount (Yen)")

# レイアウト調整
plt.tight_layout()
plt.show()

print("グラフを表示しました")
```

#### 5. 実行

ノートブックの各セルを順番に実行します：

**実行方法：**
- `Shift + Enter` で各セルを順番に実行
- または、「▶ すべて実行」ボタンで全体を実行

**実行結果の例：**

各セルを実行すると、以下のような出力とグラフが表示されます：

- セル4：データの先頭5行と概要が表示される
- セル6：月別売上が表示される
- セル8：カテゴリ別売上が表示される
- セル10：全体統計が表示される
- セル12：月別とカテゴリ別のグラフが並んで表示される

**Jupyterノートブックの利点：**
- 途中結果を確認しながら進められる
- エラーがあるセルだけ修正して再実行できる
- グラフがノートブック内に表示される
- Markdownセルで説明を書けるので、レポートとして使える

---

## まとめ

この章では、実践的な開発の流れを学びました：

- ✅ プロジェクト開始から完成までの12ステップ
- ✅ エラーメッセージの読み方
- ✅ print文を使ったデバッグ
- ✅ 読みやすいコードの書き方
- ✅ 関数に分ける考え方
- ✅ 完全な開発フローの実践例

**重要なポイント：**
1. 手順を守って進める
2. エラーは恐れず、メッセージをよく読む
3. print文でこまめに確認
4. コメントを活用
5. 関数で処理を分割

次の章では、初心者がよくつまずくポイントを集中的に解説します。

---

## 確認問題

1. プロジェクトを始める時、最初に作るべきものは何ですか？
2. conda環境を作成した後、必ずやるべきことは何ですか？
3. `NameError: name 'data' is not defined` というエラーが出ました。何が原因として考えられますか？
4. デバッグで最も基本的な方法は何ですか？
5. コメントには「何をしているか」ではなく、「何」を書くべきですか？
6. 同じ処理を何度も書く代わりに、何を使うべきですか？

---

**前の章へ：** [第5章：ライブラリの理解](./第5章_ライブラリの理解.md)
**次の章へ：** [第7章：つまずきポイント集](./第7章_つまずきポイント集.md)
